#!/bin/bash

toggle_1password() {
    # Get ID and class of the currently focused window
    local original_window
    original_window=$(hyprctl activewindow -j | jq -r '.address')
    local original_class
    original_class=$(hyprctl activewindow -j | jq -r '.class')

    # Check if 1Password is already running
    local running
    running=$(hyprctl -j clients | jq -r '.[] | select(.class == "1Password" or .class == "1password") | .workspace.id' | head -n1)

    if [[ -n $running ]]; then
        # Focus 1Password window
        hyprctl dispatch focuswindow "class:^(1Password|1password)$"
    fi

    1password --toggle

    # Optional: give it a moment to toggle (uncomment if needed)
    # sleep 0.2

    # Refocus original window if it wasn't 1Password
    # if [[ "$original_class" != "1Password" && "$original_class" != "1password" && -n $original_window ]]; then
    #     hyprctl dispatch focuswindow address:$original_window
    # fi
}

toggle_1password
